generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/**
 * —— Departments ——
 */
model Department {
  id          Int      @id @default(autoincrement())
  name        String   @unique @db.VarChar(100)
  shortCode   String?  @unique @db.VarChar(10)
  location    String?  @db.VarChar(100)
  description String?  @db.VarChar(500)
  status      Boolean  @default(true)
  timeFrom    String?
  timeTo      String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  procedures  Procedure[]
  doctorLinks DoctorDepartment[]

  @@index([name])
}

/**
 * —— Procedures ——
 */
model Procedure {
  id           Int        @id @default(autoincrement())
  status       Boolean    @default(true)
  name         String     @db.VarChar(100)
  shortCode    String?    @db.VarChar(10)
  description  String?    @db.VarChar(500)
  departmentId Int
  department   Department @relation(fields: [departmentId], references: [id], onDelete: Restrict)
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt

  feeLinks DoctorProcedureFee[]

  @@unique([departmentId, name])
  @@index([departmentId])
  @@index([name])
}

/**
 * —— Doctor ——
 */
model Doctor {
  id     Int     @id @default(autoincrement())
  status Boolean @default(true)

  name            String   @db.VarChar(100)
  guardianName    String?  @db.VarChar(100)
  gender          String?
  dateOfBirth     String?
  age             Int
  idCard          String   @unique @db.VarChar(20)
  phoneNumber     String   @unique @db.VarChar(20)
  email           String   @unique @db.VarChar(100)
  address         String?  @db.VarChar(255)
  specialization  String?  @db.VarChar(100)
  qualification   String?  @db.VarChar(100)
  subSpecialities String?  @db.VarChar(100)
  experience      Int
  languages       String?  @db.VarChar(100)
  joinDate        String?
  employmentType  String?
  shiftType       String?
  timingFrom      String?  @db.VarChar(10)
  timingTo        String?  @db.VarChar(10)
  availableDays   String[] @db.VarChar(100)
  maxPatients     Int

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  departmentLinks DoctorDepartment[]
  feeLinks        DoctorProcedureFee[]

  @@index([name])
  @@index([specialization])
}

/**
 * —— Doctor ↔ Department ——
 */
model DoctorDepartment {
  id           Int @id @default(autoincrement())
  doctorId     Int
  departmentId Int

  doctor     Doctor     @relation(fields: [doctorId], references: [id], onDelete: Cascade)
  department Department @relation(fields: [departmentId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@unique([doctorId, departmentId])
  @@index([departmentId])
}

/**
 * —— Fee Policies ——
 */
model FeePolicy {
  id   Int     @id @default(autoincrement())
  name String  @unique @db.VarChar(100)
  type String?

  fixedAmount        Decimal? @db.Decimal(10, 2)
  doctorPercentage   Decimal? @db.Decimal(5, 2)
  hospitalPercentage Decimal? @db.Decimal(5, 2)

  validFrom DateTime?
  validTo   DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  feeLinks DoctorProcedureFee[]
}

/**
 * —— Doctor ↔ Procedure Fee Assignment ——
 */
model DoctorProcedureFee {
  id          Int @id @default(autoincrement())
  doctorId    Int
  procedureId Int
  feePolicyId Int

  doctor    Doctor    @relation(fields: [doctorId], references: [id], onDelete: Cascade)
  procedure Procedure @relation(fields: [procedureId], references: [id], onDelete: Cascade)
  feePolicy FeePolicy @relation(fields: [feePolicyId], references: [id], onDelete: Restrict)

  // Optional overrides
  overrideFixedAmount        Decimal? @db.Decimal(10, 2)
  overrideDoctorPercentage   Decimal? @db.Decimal(5, 2)
  overrideHospitalPercentage Decimal? @db.Decimal(5, 2)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([doctorId, procedureId])
  @@index([feePolicyId])
}
